"use strict";

const EMERGENCY_KIT_VERSION = "V1";

    // US Letter
const DOC_WIDTH = 612;
const DOC_HEIGHT = 792;

    // Pretty colours
const OP_BLUE = "#0080FF";
const OP_DARK_BLUE = "#0066CC";
const OP_GRAY = "#F5F9FA";


const OP_OUTLINE_RED = [ 251.2, 236, 237.2 ];
const OP_RED = [ 243.6, 198, 201.6 ];
const OP_DARK_RED = "#d9414e";

  // Doc measurements
const LEFT_MARGIN = 36;
const RIGHT_MARGIN = 36;
const MAX_WIDTH = 540;


let PDFDocument = require("pdfkit");
let blobStream = require("blob-stream");
let moment = require("moment");
let fs = require("fs");


// export function getQRCodeDataURL(url: string, opts?: { colorDark?; colorLight?; width?; height?}): string {
//     var settings = _.extend({
//         text: url,
//         correctLevel: 1
//     }, opts);

//     // Must render to a div before extracting the URL
//     var qr = new QRCode(document.createElement("div"), settings);
//     var data = qr._el.querySelector("canvas").toDataURL();
//     return data;
// }


window.EmergencyKit = class EmergencyKit {
    constructor(options) {
        this.email = options.email;
        this.name = options.name;
        this.accountKey = options.accountKey;
        this.domain = options.domain;
        this.teamURL = options.teamURL;
        this.dataURL = options.dataURL;
        this.filename = options.filename || `1Password Emergency Kit-${domain}`;
        this._downloadURL = null;
    }

    template() {
        return {
            version: EMERGENCY_KIT_VERSION,
            email: this.email,
            name: this.name,
            teamURL: this.teamURL,
            domain: this.domain,
            accountKey: this.accountKey,
            createdAt: moment().format("MMMM Do, YYYY"),
            qrCode: ""
        };
    }

    getDownloadURL() {
        return new Promise((fulfill, reject) => {
            if (this._downloadURL) {
                fulfill(this._downloadURL);
                return;
            }
            let server, doc;

            doc = render(this.template(), [
                draw.header,
                draw.createdFor,
                draw.accountKey,
                draw.userName,
                draw.signInURL,
                draw.masterPassword,
                draw.documentation
            ]);

            let stream = doc.pipe(blobStream());

            let start = Date.now();
            stream.on("finish", () => {
                let end = Date.now();
                let emergencyKitURL= stream.toBlobURL('application/pdf');

                console.log("Emergency Kit rendered in " + (end - start) + " ms.");
                fulfill(emergencyKitURL);
            });
            doc.end();
        });
    }
}

let draw = {
    header: function(kit) {
        let doc = this;

        // Marquee
        doc.save()
            .rect(0, 0, DOC_WIDTH, 32)
            .fill(OP_DARK_BLUE);


        // "PRIVATE * CONFIDENTIAL"
        doc
            .fontSize(11)
            .fill("#FFFFFF")
            .text("PRIVATE - CONFIDENTIAL - PRIVATE - CONFIDENTIAL - PRIVATE - CONFIDENTIAL - PRIVATE - CONFIDENTIAL", 20, 20);

        // Main header
        doc.rect(0, 30, DOC_WIDTH, 82)
            .fill(OP_DARK_BLUE);

        // "Emergency Kit"
        doc
            .moveDown(2.8)
            .fontSize(20)
            .fill("#FFFFFF")
            .text("Emergency Kit", 378.5);

        // 1Password logo

        doc
            .translate(25, 60)
            .path("M123.054446,17.5797629 C122.660682,17.5299971 122.635681,17.4740106 122.635681,17.0821051 L122.635681,0 L117.34174,0 L117.05423,2.12748723 L118.504282,2.62514506 C118.741791,2.70601446 118.848044,2.88641542 118.848044,3.15390651 L118.848044,7.1476106 C117.848008,6.4135653 116.660465,5.88480385 115.13541,5.88480385 C113.066585,5.88480385 111.122765,6.88634024 110.172731,9.3497465 L110.172731,6.12119132 C109.697714,5.99055614 108.48517,5.88480385 107.878898,5.88480385 C106.191337,5.88480385 105.035045,6.91122313 104.166264,8.24867855 L104.010008,8.24867855 L103.691247,6.14607422 L99.0535791,6.14607422 L98.884823,7.40888096 C99.0598293,7.75724144 99.2223352,8.11804337 99.3660904,8.48506602 L100.19112,8.77744 C100.45363,8.8583094 100.534883,9.03871036 100.534883,9.33108434 L100.534883,17.0323393 C100.534883,17.4242448 100.484881,17.5051142 100.116117,17.5611007 L98.9285746,17.7166188 L98.9285746,19.844106 L107.541386,19.844106 L107.541386,17.7415017 L104.935042,17.5299971 C104.541277,17.5051142 104.516276,17.4242448 104.516276,17.0074564 L104.516276,10.0402467 C104.910041,9.69810699 105.72882,9.11957976 106.410095,9.11957976 C106.622603,9.11957976 106.697605,9.16934554 106.753857,9.40573301 L107.016367,10.7991749 L109.747716,10.8924858 C109.622711,11.5705446 109.553959,12.3294728 109.553959,13.1692704 C109.553959,18.1893937 111.554031,20.1613629 114.666643,20.1613629 C116.591713,20.1613629 117.879259,19.4273176 118.985549,18.3449118 L119.173056,18.3697947 L119.435566,19.844106 L124.335743,19.844106 L124.335743,17.7663846 L123.054446,17.5797629 L123.054446,17.5797629 Z M118.679288,15.9250506 C117.966762,16.5284607 116.991727,17.0572222 116.097945,17.0572222 C114.435385,17.0572222 113.697858,15.6388973 113.697858,13.088401 C113.697858,10.7494092 114.460386,8.93295807 116.410456,8.93295807 C117.172984,8.93295807 118.016764,9.27509783 118.673038,9.72298988 L118.673038,15.9250506 L118.679288,15.9250506 Z")
            .fill("#FFFFFF")
            .stroke();
        doc
            .path("M73.6526613,8.32954795 L75.1527155,8.48506602 L73.1776441,15.8690641 L73.0213885,15.8690641 L70.7525565,6.48821397 L66.7774129,6.48821397 L64.4335782,15.8690641 L64.2460714,15.8690641 L62.1397453,8.48506602 L63.6147986,8.32954795 L63.6147986,6.14607422 L56.9520579,6.14607422 L56.8770551,6.53175903 C55.9707724,6.24560578 54.1832078,5.87858313 52.3518916,5.87858313 C49.3205321,5.87858313 46.5266811,7.21603855 46.5266811,10.4756973 C46.5266811,13.9157571 49.4267859,14.3947528 51.6393659,14.7866583 C52.9831644,15.0230458 54.0394526,15.3403026 54.0394526,16.3916048 C54.0394526,17.3620376 53.2519242,17.7601639 51.8518736,17.7601639 C50.8518374,17.7601639 50.1393117,17.6046458 49.8205502,17.4988935 C49.5830416,17.4491277 49.5330398,17.3433754 49.5017886,17.1069879 L49.2392792,15.6077937 L46.7016875,15.421172 C46.5954336,12.5285359 44.3141012,11.8131528 42.2827778,11.3528193 C40.6764698,10.9857966 39.2264174,10.7494092 39.2264174,9.67322409 C39.2264174,8.8334265 39.963944,8.33576867 41.2827417,8.33576867 C41.9952674,8.33576867 42.6265402,8.44152096 42.9703026,8.54727325 C43.1578094,8.59703903 43.2078112,8.70279132 43.2328121,8.9142959 L43.4953216,10.2828549 L46.3141735,10.4694766 L46.3141735,6.65617349 C45.5766468,6.37002024 43.5453234,5.89102458 41.4639982,5.89102458 C38.4326387,5.89102458 35.6387877,7.22848 35.6387877,10.4881388 C35.6387877,13.9281986 38.5388925,14.4071942 40.7514725,14.7990998 C42.095271,15.0354872 43.1515592,15.3527441 43.1515592,16.4040463 C43.1515592,17.374479 42.3640307,17.7726053 40.9639802,17.7726053 C39.963944,17.7726053 39.2514183,17.6170872 38.9326568,17.5113349 C38.6951482,17.4615692 38.6451464,17.3558169 38.6138952,17.1194294 L38.3513858,15.6202352 L35.5325339,15.4087306 L35.5325339,17.666853 L34.9137615,17.5611007 C34.5199973,17.5113349 34.4949964,17.4553484 34.4949964,17.0323393 L34.4949964,10.6436569 C34.4949964,6.96098891 32.8886884,5.88480385 28.8822936,5.88480385 C27.2072331,5.88480385 25.1384083,6.12741205 24.0196179,7.4462053 C24.050869,7.11650699 24.0696197,6.7681465 24.0696197,6.40734458 C24.0696197,3.38407325 22.5945664,0.808693976 17.7193903,0.808693976 L8.79406776,0.808693976 L8.79406776,2.91129831 L10.4566278,3.09792 C10.8253912,3.12280289 10.875393,3.22855518 10.875393,3.62668144 L10.875393,17.0572222 C10.875393,17.4491277 10.8253912,17.5299971 10.4566278,17.5859836 L8.99407498,17.7477224 L7.0877561,17.5859836 C6.69399187,17.5611007 6.66899097,17.4802313 6.66899097,17.0572222 L6.66899097,4.7028665 L0.337512195,4.7028665 L0.0500018067,6.85523662 L2.34383469,7.32801156 C2.60634418,7.40888096 2.68759711,7.56439903 2.68759711,7.8816559 L2.68759711,17.0572222 C2.68759711,17.4491277 2.6375953,17.55488 2.26883198,17.5859836 L0.00625022584,17.7726053 L0.00625022584,19.844106 L8.80031798,19.844106 L9.25658447,19.844106 L19.1319413,19.844106 L19.1319413,17.7663846 L15.3630551,17.55488 C14.9692909,17.5051142 14.94429,17.4491277 14.94429,17.0261186 L14.94429,12.8209099 L16.8693595,12.8209099 C19.92572,12.8209099 22.1820515,11.9562294 23.3008419,9.93449446 L26.9447236,10.2455306 C26.9447236,8.66546699 27.6009973,8.48506602 28.8697932,8.48506602 C30.5011021,8.48506602 30.6323568,9.32486361 30.6323568,10.5627875 L30.6323568,12.0059952 L27.6009973,12.2174998 C24.3071283,12.4290043 22.6758193,13.6358246 22.6758193,16.2671904 C22.6758193,17.8970198 23.2008383,20.1551422 26.5197082,20.1551422 C28.6260343,20.1551422 29.944832,19.3651104 30.9448681,18.3946776 L31.0761229,18.4195605 L31.3386324,19.8378853 L36.1888076,19.8378853 L36.1888076,19.4770834 C37.1513424,19.7881195 38.938907,20.1551422 40.7639729,20.1551422 C43.4578203,20.1551422 45.6704002,19.3029031 46.4329278,17.2998304 L46.4329278,19.2095923 C46.9079449,19.5268492 49.2517796,20.1551422 51.6518663,20.1551422 C54.9957372,20.1551422 57.6083316,18.8425696 57.6083316,15.6326766 C57.6083316,12.5596395 55.2644969,11.8193735 53.1831717,11.3465986 C51.5768636,10.9795759 50.1268112,10.7431884 50.1268112,9.66700337 C50.1268112,8.82720578 50.8643379,8.32954795 52.1831355,8.32954795 C52.8956613,8.32954795 53.5269341,8.43530024 53.8706965,8.54105253 C54.0582033,8.59081831 54.1082051,8.6965706 54.133206,8.90807518 L54.3957155,10.2766342 L57.2145673,10.4632559 L57.2145673,8.42285879 L57.6520831,8.51616964 C57.9708447,8.59703903 58.1020994,8.64680482 58.2083532,8.96406168 L61.5084725,19.844106 L66.2523939,19.844106 L68.3337191,11.0417831 L68.4899747,11.0417831 L70.5462991,19.844106 L74.7089495,19.844106 L77.409047,10.7929542 C77.6715565,9.09469687 78.3153298,7.51463325 79.2466134,6.15229494 L73.9964237,6.15229494 L73.6526613,8.32954795 L73.6526613,8.32954795 Z M16.244337,10.0091431 L14.9255393,10.0091431 L14.9255393,3.67644723 L16.4818455,3.67644723 C18.3506631,3.67644723 19.9069693,4.12433928 19.9069693,6.64373205 C19.9069693,9.61723759 17.98815,10.0091431 16.244337,10.0091431 L16.244337,10.0091431 Z M30.6198564,16.3729426 C30.0135845,16.8208347 29.1198022,17.3184925 28.2197697,17.3184925 C27.3509883,17.3184925 26.7197155,16.926587 26.7197155,15.8752848 C26.7197155,14.8239826 27.2759856,14.4320771 28.8260416,14.3263248 L30.6198564,14.1956896 L30.6198564,16.3729426 L30.6198564,16.3729426 Z")
            .fill("#FFFFFF")
            .stroke();

        // 1Password Icon
        doc
            .translate(77.252791, 1.119730)
            .path("M11.4316631,0.0248828916 C9.88785728,0.0248828916 8.3940533,0.32347759 6.98150226,0.920666988 C5.61895303,1.49297349 4.40015899,2.31410892 3.35012105,3.35919036 C2.30008311,4.40427181 1.4750533,5.61731277 0.900032521,6.97343036 C0.306261066,8.37931373 0,9.8660665 0,11.4025851 C0,12.9391036 0.30001084,14.4258564 0.900032521,15.8317398 C1.4750533,17.1878573 2.30008311,18.4008983 3.35012105,19.4459798 C4.40015899,20.4910612 5.61895303,21.3121966 6.98150226,21.8845031 C8.3940533,22.4754718 9.88785728,22.7802872 11.4316631,22.7802872 C12.9754688,22.7802872 14.4692728,22.4816925 15.8818239,21.8845031 C17.2443731,21.3121966 18.4631671,20.4910612 19.5132051,19.4459798 C20.563243,18.4008983 21.3882728,17.1878573 21.9632936,15.8317398 C22.5570651,14.4258564 22.8633261,12.9391036 22.8633261,11.4025851 C22.8633261,9.8660665 22.5633153,8.37931373 21.9632936,6.97343036 C21.3882728,5.61731277 20.563243,4.40427181 19.5132051,3.35919036 C18.4631671,2.31410892 17.2443731,1.49297349 15.8818239,0.920666988 C14.4692728,0.32347759 12.9754688,0.0248828916 11.4316631,0.0248828916 L11.4316631,0.0248828916 L11.4316631,0.0248828916 Z")
            .stroke("#FFFFFF");

        doc
            .path("M11.4316631,2.61270361 C6.55648691,2.61270361 2.60634418,6.54420048 2.60634418,11.3963643 C2.60634418,16.2485282 6.55648691,20.1800251 11.4316631,20.1800251 C16.3068392,20.1800251 20.2569819,16.2485282 20.2569819,11.3963643 C20.2569819,6.5504212 16.3068392,2.61270361 11.4316631,2.61270361 L11.4316631,2.61270361 Z M11.4316631,18.0089928 C7.76278049,18.0089928 4.78767299,15.0479287 4.78767299,11.3963643 C4.78767299,7.7448 7.76278049,4.7837359 11.4316631,4.7837359 C15.1005456,4.7837359 18.0756531,7.7448 18.0756531,11.3963643 C18.0756531,15.0541494 15.1005456,18.0089928 11.4316631,18.0089928 L11.4316631,18.0089928 Z")
            .fill("#FFFFFF")
            .stroke();
        doc
            .path("M12.2254417,12.5845224 L13.0254706,13.3807749 L13.0254706,16.3605012 L9.83160525,16.3605012 L9.83160525,10.9982381 L10.6316342,10.2019855 L9.83160525,9.40573301 L9.83160525,6.42600675 L13.0254706,6.42600675 L13.0254706,11.7882699 L12.2254417,12.5845224 L12.2254417,12.5845224 Z")
            .fill("#FFFFFF")
            .stroke()
            .restore();

        // Emergency Kit Icon

        doc
            .save()
            .lineWidth(2)
            .roundedRect(543, 60, 28, 28, 1)
            .stroke("#FFFFFF");

        doc
            .lineWidth(1)
            .translate(543, 60)
            .path("M24.9895264,10.57041 C25.2418504,10.57041 25.4381025,10.7700535 25.4381025,11.026738 L25.4381025,24.973262 C25.4381025,25.2299465 25.2418504,25.42959 24.9895264,25.42959 L3.00929628,25.42959 C2.75697221,25.42959 2.56072016,25.2299465 2.56072016,24.973262 L2.56072016,11.026738 C2.56072016,10.7700535 2.75697221,10.57041 3.00929628,10.57041 L24.9895264,10.57041 L24.9895264,10.57041 Z")
            .stroke();

        doc
            .path("M11.8074575,4.62862809 L9.37287399,3.06061334 C9.09303681,2.89555915 8.75723218,3.08812237 8.75723218,3.3907217 L8.75723218,4.29851972 L4.39177206,4.29851972 C4.19588603,4.29851972 4,4.51859196 4,4.71115518 L4,5.31635385 C4,5.50891707 4.19588603,5.70148028 4.39177206,5.70148028 L8.75723218,5.70148028 L8.75723218,6.6092783 C8.75723218,6.91187763 9.12102053,7.10444085 9.40085771,6.93938666 L11.8354412,5.31635385 C12.059311,5.15129967 12.059311,4.79368227 11.8074575,4.62862809 L11.8074575,4.62862809 Z")
            .fill("#FFFFFF");

        doc
            .path("M16.1722326,5.37137191 L18.6441591,6.93938666 C18.9188177,7.10444085 19.3308054,6.91187763 19.3308054,6.6092783 L19.3308054,5.67397125 L23.4781488,5.67397125 C23.6704098,5.67397125 24,5.48140804 24,5.28884482 L24,4.68364615 C24,4.49108293 23.6704098,4.27101069 23.4781488,4.27101069 L19.3033396,4.27101069 L19.3033396,3.3907217 C19.3033396,3.08812237 18.863886,2.89555915 18.6166933,3.06061334 L16.1996984,4.68364615 C15.9525058,4.84870033 15.9250399,5.20631773 16.1722326,5.37137191 L16.1722326,5.37137191 Z")
            .fill("#FFFFFF");

        doc
            .circle(14, 5, 1)
            .fill("#FFFFFF");

        doc
            .path("M20.1500902,14.8737864 C21.2503761,14.8737864 22.1531748,15.8058252 22.1531748,16.9417476 L22.1531748,20.0582524 C22.1531748,21.1941748 21.2503761,22.1262136 20.1500902,22.1262136 L17.1313572,22.1262136 C16.0310713,22.1262136 15.1282726,21.1941748 15.1282726,20.0582524 L15.1282726,20.0582524 L11.093891,20.0582524 L11.093891,20.0582524 L10.0782425,19.0097087 L10.0782425,19.0097087 L9.06259403,20.0582524 L9.06259403,20.0582524 L8.04694552,19.0097087 L8.04694552,19.0097087 L7.03129701,20.0582524 L7.03129701,20.0582524 L6.01564851,17.9902913 L6.01564851,17.9902913 L7.03129701,16.9417476 L7.03129701,16.9417476 L15.1000602,16.9417476 L15.1000602,16.9417476 C15.1000602,15.8058252 16.0028588,14.8737864 17.1031447,14.8737864 L20.1500902,14.8737864 L20.1500902,14.8737864 Z M20.6579145,21.1067961 L20.6579145,21.1067961 C20.9400391,21.1067961 21.1657387,20.8446602 21.1657387,20.5825243 L21.1657387,16.4466019 C21.1657387,16.1553398 20.9400391,15.9223301 20.6579145,15.9223301 L20.629702,15.9223301 C20.3475774,15.9223301 20.1500902,16.184466 20.1500902,16.4466019 L20.1500902,20.5825243 C20.1500902,20.8737864 20.3757899,21.1067961 20.6579145,21.1067961 L20.6579145,21.1067961 Z M20.1500902,14 L17.1313572,14 C15.8617965,14 14.7615106,14.8737864 14.3947487,16.0679612 L7.05950947,16.0679612 L6.69274751,16.0679612 L6.43883538,16.3300971 L5.42318688,17.3786408 L5,17.815534 L5.28212459,18.368932 L6.29777309,20.4368932 L6.52347276,20.9320388 L7.05950947,20.9320388 L7.39805897,20.9320388 L7.6519711,20.6699029 L8.04694552,20.2621359 L8.44191994,20.6699029 L8.69583207,20.9320388 L9.03438157,20.9320388 L9.37293107,20.9320388 L9.6268432,20.6699029 L10.0218176,20.2621359 L10.416792,20.6699029 L10.6707042,20.9320388 L11.0092537,20.9320388 L14.3947487,20.9320388 C14.7615106,22.1262136 15.8335841,23 17.1313572,23 L20.1500902,23 C21.7299879,23 22.9995485,21.6601942 22.9995485,20.0582524 L22.9995485,16.9417476 C23.027761,15.3398058 21.7299879,14 20.1500902,14 L20.1500902,14 L20.1500902,14 Z")
            .fill("#FFFFFF")
            .restore();
    },

    createdFor: function(kit) {
        let doc = this;

        // Created for:
        doc
            .save()
            .fontSize(13)
            .fill("#000")
            .text(`Generated for ${kit.name} on ${kit.createdAt}.`, 38, 131, { width: 500, align: "center" });
    },

    accountKey: function(kit) {
        let doc = this;
        // 1. Account Key

        doc
            .restore()
            .fontSize(14)
            .fill("#000")
            .font("Helvetica-Bold")
            .text("Account Key", 32, 167);

        doc.lineWidth(1)
            .moveTo(33.5, 196.7)
            .lineTo(577.6, 196.7)
            .stroke("#000");

        doc.lineWidth(1)
            .moveTo(33.5, 259.6)
            .lineTo(577.6, 259.6)
            .stroke("#000");

        doc
            .fontSize(22)
            .fill("#000")
            .font("Courier")
            .text(kit.accountKey, 32, 220, { width: 561});
    },

    userName: function(kit) {
        let doc = this;
        // 2. Username

        doc
            .fontSize(14)
            .fill("#000")
            .font("Helvetica-Bold")
            .text("Email address", 32, 300);

        doc
            .font("Helvetica")
            .text(kit.email, 198, 300, {link: "mailto:"+kit.email});
    },

    signInURL: function(kit) {
        let doc = this;

        // 3. Sign-in url

        doc
            .fontSize(14)
            .fill("#000")
            .font("Helvetica-Bold")
            .text("Team domain", 32, 330);

        doc
            .font("Helvetica")
            .text(`${kit.domain}`, 198, 330);
    },

    masterPassword: function(kit) {
        let doc = this;

        // 4. Master Password

        doc
            .fontSize(14)
            .fill("#000")
            .font("Helvetica-Bold")
            .text("Master Password", 32, 380);
        doc.lineWidth(1)
            .moveTo(33.5, 430)
            .lineTo(577.6, 430)
            .stroke("#979797");

        doc
            .translate(0, -110)
            .path("M35.114542,531.784215 L33.0700689,536.613551 C32.9784337,536.705387 32.9770483,536.848486 33.0637356,536.93577 C33.1506207,537.023253 33.2950995,537.021273 33.3859429,536.930426 L38.215887,534.885876 C38.2172724,534.88449 38.2164808,534.881719 38.2186579,534.880334 L35.1200837,531.781444 C35.1186983,531.783621 35.1159274,531.78283 35.114542,531.784215 L35.114542,531.784215 Z M51.7911491,520.218352 L49.7801237,518.208636 C49.5030412,517.930158 49.0521884,517.930752 48.7745121,518.208636 L35.7223423,531.257936 L38.7403646,534.276865 L51.7911491,521.225586 C52.069617,520.946909 52.069617,520.497029 51.7911491,520.218352 L51.7911491,520.218352 Z")
            .fill("#979797");
    },

    documentation: function(kit) {
        let doc = this;

        /* Documentation */
        doc.lineWidth(0.5)
            .rect(33, 564, 545, 250)
            .fillAndStroke("#F5F9FA", "#979797");

        doc
            .fontSize(13)
            .fill("#000")
            .font("Helvetica")
            .text("Sign in to 1Password for Teams with the following link:", 40, 575)
            .moveDown(0.25)
            .fill(OP_BLUE)
            .text(kit.teamURL);

        // // QR code
        // doc
        //     .save()
        //     .moveDown(0.75)
        //     .image(kit.qrCode, 470);

        // Instruction numbers
        doc
            .translate(35, 620)
            .path("M22.7709474,26.5263158 L22.7709474,24.5804211 L20.7511579,24.408 C20.3816842,24.3833684 20.3570526,24.3094737 20.3570526,23.9153684 L20.3570526,12.3385263 L14.4454737,12.3385263 L14.1745263,14.3583158 L16.3174737,14.8016842 C16.5637895,14.8755789 16.6376842,15.0233684 16.6376842,15.3189474 L16.6376842,23.9153684 C16.6376842,24.2848421 16.5884211,24.3833684 16.2435789,24.408 L14.1252632,24.5804211 L14.1252632,26.5263158 L22.7709474,26.5263158 Z")
            .fill(OP_BLUE)

        doc
            .translate(0, 24)
            .path("M22.2288421,24.5142 L22.2288421,20.115 L19.7629474,20.115 L19.4372632,21.9636 C19.3907368,22.1976 19.2976842,22.2444 19.0650526,22.2444 L15.6453684,22.2444 L18.2741053,19.7172 C19.9723158,18.0792 21.4844211,16.6284 21.4844211,14.4288 C21.4844211,12.2292 20.2049474,10.6848 16.5991579,10.6848 C14.1565263,10.6848 11.3416842,11.2932 11.3184211,15.0138 L14.4822105,15.2946 C14.4822105,13.6332 15.0172632,13.212 16.2967368,13.212 C17.5296842,13.212 17.9484211,13.8438 17.9484211,14.7096 C17.9484211,16.0434 16.9481053,16.9794 14.5985263,19.2726 L11.4812632,22.338 L11.4812632,24.5142 L22.2288421,24.5142 Z")
            .fill(OP_BLUE)

        doc
            .translate(0, 23)
            .path("M19.583827,17.9278357 C21.0985266,17.4710215 22.3487548,16.1967504 22.3487548,14.1771509 C22.3487548,11.6045658 20.9302266,10.1860376 17.2276275,10.1860376 C14.7031282,10.1860376 11.8420289,10.8351946 11.8420289,14.6339651 L15.1358995,14.9224793 C15.1358995,13.2154369 15.7610136,12.7826655 17.0593276,12.7826655 C18.4057273,12.7826655 18.8144557,13.5279939 18.8144557,14.4416223 C18.8144557,15.9803647 17.8767845,16.8218645 16.1456992,17.0382502 L14.9675995,17.1825073 L14.9675995,19.5867924 C15.6888851,19.4665781 16.1456992,19.4184924 16.7467705,19.4184924 C18.2374273,19.4184924 19.1510556,20.0195637 19.1510556,21.4861776 C19.1510556,23.1691772 17.9969988,23.6500342 16.6505991,23.6500342 C14.9675995,23.6500342 13.9577998,22.9527916 13.0441715,22.0632061 L11.1207434,24.178977 C12.3469288,25.5253766 14.5107854,26.3909193 16.9391133,26.3909193 C20.377241,26.3909193 22.7574833,24.9002625 22.7574833,21.7266062 C22.7574833,19.5627496 21.6274693,18.3365641 19.583827,18.0240071 L19.583827,17.9278357 Z")
            .fill(OP_BLUE);

        // Instructions
        doc
            .restore()
            .fill("#000")
            .font("Helvetica")
            .text("Print out this document.", 65, 635)
            .moveDown(0.5)
            .text("Fill in your Master Password above.")
            .moveDown(0.5)
            .text("Store your Emergency Kit somewhere safe, accessible, and offline.");
        doc
            .moveDown(2.5)
            .font("Helvetica-Bold")
            .moveDown(0.25)
            .text("We will never ask you for your Account Key or Master Password.", 40)
            .font("Helvetica")
            .moveDown(0.25)
            .text("For questions and support, contact us at: support@1password.com.")
            .moveDown(0.25)
            .text("Please do not include this Emergency Kit when contacting support!");

    },

    footer: function(kit) {
        let doc = this;
        doc
            .save()
            .rect(0, DOC_HEIGHT - 32, DOC_WIDTH, 42)
            .fill(OP_DARK_BLUE);
        doc
            .fontSize(11)
            .fill("#FFFFFF")
            .text("KEEP SAFE - DON’T THROW AWAY - KEEP SAFE - DON’T THROW AWAY - KEEP SAFE - DON’T THROW AWAY", 20, DOC_HEIGHT - 25)
            .restore();
    }
};

function render(kit, drawFuncs) {
    let doc = new PDFDocument({
        margin: 0,
        size: "letter"
    });

    let header = fs.readFileSync('images/header@3x.png');
    let pencil = fs.readFileSync('images/pencil@3x.png');
    //doc.registerFont('proxima', font, 'ProximaNova-Regular');

    // Banner
    doc
        .image(header, LEFT_MARGIN, RIGHT_MARGIN, {width: MAX_WIDTH});


    //Field BG
    doc
        .roundedRect(LEFT_MARGIN, 304, MAX_WIDTH, 271, 10)
        .fillAndStroke(OP_OUTLINE_RED, OP_RED);

    // Fields
    doc
        .roundedRect(LEFT_MARGIN + 18, 354, MAX_WIDTH - 36, 36, 5)
        .roundedRect(LEFT_MARGIN + 18, 409, MAX_WIDTH - 36, 36, 5)
        .roundedRect(LEFT_MARGIN + 18, 465, MAX_WIDTH - 36, 36, 5)
        .fill("white")
        .roundedRect(LEFT_MARGIN + 18, 521, MAX_WIDTH - 36, 36, 5)
        .fillAndStroke("white", OP_DARK_RED);

    // Pencil
    doc
        .image(pencil, LEFT_MARGIN + 28, 530, {width: 19});

    // Labels
    doc
        .fontSize(16)
        .fillColor(OP_DARK_RED)
        .text("SIGN IN DETAILS", LEFT_MARGIN, 318, {align: "center"});


    // drawFuncs.forEach((drawFunc) => {
    //     let drawSubComponent = drawFunc.bind(doc);
    //     drawSubComponent(kit);
    // });

    return doc;
}
